{% extends 'layouts/account_layout.html' %}
{% load static %}

{% block title %}
    {% if user.first_name and user.last_name %}{{ user.first_name }} {{ user.last_name }}{% else %}{{ user.username }}{% endif %}
{% endblock title %}


{% block account_layout %}
<div class="w-full md:max-w-lg grid gap-4">
    <div class="grid border-b border-border-200 pb-4">
        <h2 class="text-2xl font-medium">Аккаунт</h2>
        <span class="text-muted">Негізгі персоналды мәліметтері</span>
    </div>

    <form method="post" enctype="multipart/form-data" class="space-y-4">
        {% csrf_token %}

        <!-- Avatar field -->
        <div class="relative w-24 h-24 mx-auto md:mx-0">
            <label for="avatar-input" class="cursor-pointer group block w-24 h-24 rounded-full overflow-hidden relative">
                {% if user.avatar %}
                    <img 
                        id="avatar-preview" 
                        src="{{ user.avatar.url }}" 
                        alt="Avatar" 
                        class="w-full h-full object-cover transition-opacity duration-300 group-hover:opacity-70"
                    >
                {% else %}
                    <div 
                        id="avatar-preview"
                        class="w-full h-full bg-neutral-100 flex items-center justify-center text-foreground text-4xl"
                    >
                        {{ user.first_name|first|upper }}{{ user.last_name|first|upper }}
                    </div>
                {% endif %}

                <div class="absolute inset-0 bg-foreground/70 text-white flex items-center justify-center opacity-0 group-hover:opacity-100 transition">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-image-icon lucide-image">
                        <rect width="18" height="18" x="3" y="3" rx="2" ry="2" />
                        <circle cx="9" cy="9" r="2" />
                        <path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21" />
                    </svg>
                </div>
            </label>

            <input type="file" name="avatar" id="avatar-input" accept="image/*" class="hidden">

            <script>
                const input = document.getElementById('avatar-input');
                const preview = document.getElementById('avatar-preview');

                input.addEventListener('change', function () {
                    const file = this.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function (e) {
                            if (preview.tagName === 'IMG') {
                                preview.src = e.target.result;
                            } else {
                                const img = document.createElement('img');
                                img.src = e.target.result;
                                img.className = 'w-full h-full object-cover';
                                preview.replaceWith(img);
                                img.id = 'avatar-preview';
                            }
                        };
                        reader.readAsDataURL(file);
                    }
                });
            </script>
        </div>

        <!-- first_name field -->
        <div class="relative">
            <label for="first_name" class="block mb-2 font-medium text-gray-900">
                Есімі
            </label>
            <input 
                type="text"
                id="first_name"
                name="first_name"
                value="{{ form.first_name.value }}"
                class="block w-full bg-background border border-border-300 text-sm px-4 py-2.5 rounded-xl focus:ring-primary-600 focus:border-primary-600"
                required 
            />
            {% if form.first_name.errors %}
                {% for error in form.first_name.errors %}
                    <p class="text-destructive">{{ error }}</p>
                {% endfor %}
            {% endif %}
        </div>

        <!-- last_name field -->
        <div class="relative">
            <label for="last_name" class="block mb-2 text-sm font-medium text-gray-900">
                Тегі
            </label>
            <input 
                type="text"
                id="last_name"
                name="last_name"
                value="{{ form.last_name.value }}"
                class="block w-full bg-background border border-border-300 text-sm px-4 py-2.5 rounded-xl focus:ring-primary-600 focus:border-primary-600"
                required 
            />
            {% if form.last_name.errors %}
                {% for error in form.last_name.errors %}
                    <p class="text-destructive">{{ error }}</p>
                {% endfor %}
            {% endif %}
        </div>

        <!-- submit -->
        <button 
            type="submit" 
            class="w-full md:w-auto cursor-pointer font-medium rounded-xl px-4 py-2.5 text-white bg-primary-600 hover:bg-primary-800 focus:outline-none focus:ring-4 focus:ring-primary-300"
        >
            Сақтау
        </button>
    </form>
</div>
{% endblock account_layout %}